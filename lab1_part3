<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Калькулятор</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background-color: #f3f4f6;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}
.calculator {
  background: white;
  border-radius: 20px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
  padding: 30px;
  width: 900px; 
  max-width: 95vw;
  text-align: center;
}
h2 { margin-top: 0; color: #333; margin-bottom: 20px;}


.equation-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}


input[type="text"] {
  width: 140px;
  font-size: 1.1rem;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: right;
  outline: none;
}
select {
  width: 60px;
  font-size: 1.2rem;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  cursor: pointer;
  background: #f9fafb;
}
.bracket {
  font-size: 2rem;
  color: #555;
  font-weight: 300;
}

input:focus, select:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
}


button {
  width: 200px;
  padding: 12px;
  font-size: 1.1rem;
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.2s;
  margin-top: 25px;
}
button:hover { background-color: #1d4ed8; }


.result-section {
  margin-top: 25px;
  padding-top: 15px;
  border-top: 1px solid #eee;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}
.main-result {
  font-size: 1.4rem;
  font-weight: bold;
  color: #111827;
}


.rounding-options {
  display: flex;
  gap: 20px;
  background: #f0f7ff;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #bfdbfe;
}
.rounding-options label {
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.95rem;
  color: #333;
}
.rounded-int-result {
  font-size: 1.5rem;
  color: #059669; 
  font-weight: bold;
  margin-top: 5px;
  min-height: 1.5em;
}

.error {
  color: #dc2626;
  font-size: 1.1rem;
  font-weight: bold;
}

.info {
  margin-top: 30px;
  font-size: 0.85rem;
  color: #6b7280;
  line-height: 1.4;
}
</style>
</head>
<body>
<div class="calculator">
  <h2>Калькулятор</h2>

  <div class="equation-row">
   
    <input id="num1" type="text" value="0" placeholder="Число 1">
    
   
    <select id="op1">
      <option value="add">+</option>
      <option value="sub">-</option>
      <option value="mul">×</option>
      <option value="div">÷</option>
    </select>

    <span class="bracket">(</span>

    
    <input id="num2" type="text" value="0" placeholder="Число 2">
    
   
    <select id="op2">
      <option value="add">+</option>
      <option value="sub">-</option>
      <option value="mul">×</option>
      <option value="div">÷</option>
    </select>
    

    <input id="num3" type="text" value="0" placeholder="Число 3">

    <span class="bracket">)</span>

   
    <select id="op3">
      <option value="add">+</option>
      <option value="sub">-</option>
      <option value="mul">×</option>
      <option value="div">÷</option>
    </select>


    <input id="num4" type="text" value="0" placeholder="Число 4">
  </div>

  <button id="calcBtn">Вычислить =</button>

  <div class="result-section">
    
    <div id="mainResult" class="main-result"></div>

    
    <div class="rounding-options">
      <label>
        <input type="radio" name="roundingType" value="math" checked>
        Математическое
      </label>
      <label>
        <input type="radio" name="roundingType" value="bank">
        Бухгалтерское
      </label>
      <label>
        <input type="radio" name="roundingType" value="trunc">
        Усечение
      </label>
    </div>

    <div>Результат, округленный до целых:</div>
    <div id="intResult" class="rounded-int-result"></div>
  </div>

  <div class="info">
    <p>Королёв Павел Андреевич</p>
    <p>Курс: 4, Группа: 4</p>
    <p>2025</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/decimal.js@10.4.3/decimal.min.js"></script>
<script>
Decimal.set({ precision: 40 }); 


const INTERMEDIATE_PRECISION = 10; 
const MIN_LIMIT = new Decimal("-1000000000000.0000000000");
const MAX_LIMIT = new Decimal("1000000000000.0000000000");


let currentRawResult = null;


function parseInput(value) {
  value = value.trim();
  if (!value) return null; // Пустая строка - ошибка (или можно считать 0, но по заданию строгий ввод)
  let normalized = value.replace(',', '.');
  const formatRegex = /^-?(\d+|\d{1,3}( \d{3})*)(\.\d+)?$/;
  if (!formatRegex.test(normalized)) return null;
  const cleanValue = normalized.replace(/ /g, '');
  try { return new Decimal(cleanValue); } catch { return null; }
}


function formatWithSpaces(strVal) {
  let parts = strVal.split('.');
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, " ");
  return parts.join('.');
}


function formatDisplayResult(decimalNum) {
  let rounded = decimalNum.toDecimalPlaces(6, Decimal.ROUND_HALF_UP);
  let s = rounded.toFixed(6); 
  if (s.indexOf('.') !== -1) {
      s = s.replace(/0+$/, '').replace(/\.$/, '');
  }
  return formatWithSpaces(s);
}


function calculateStep(a, b, op) {
  let res;
  if (op === 'div' && b.isZero()) {
    throw new Error("Деление на 0");
  }
  
  switch (op) {
    case 'add': res = a.plus(b); break;
    case 'sub': res = a.minus(b); break;
    case 'mul': res = a.times(b); break;
    case 'div': res = a.dividedBy(b); break;
    default: throw new Error("Неизвестная операция");
  }

  
  res = res.toDecimalPlaces(INTERMEDIATE_PRECISION, Decimal.ROUND_HALF_UP);

 
  if (res.lessThan(MIN_LIMIT) || res.greaterThan(MAX_LIMIT)) {
    throw new Error("Переполнение диапазона");
  }
  
  return res;
}


function calculate() {
  const mainResultEl = document.getElementById("mainResult");
  const intResultEl = document.getElementById("intResult");
  
  
  mainResultEl.classList.remove("error");
  intResultEl.classList.remove("error");
  mainResultEl.textContent = "";
  intResultEl.textContent = "";
  currentRawResult = null;

  
  const nums = [
    parseInput(document.getElementById("num1").value),
    parseInput(document.getElementById("num2").value),
    parseInput(document.getElementById("num3").value),
    parseInput(document.getElementById("num4").value)
  ];
  
  
  if (nums.some(n => n === null)) {
    mainResultEl.classList.add("error");
    mainResultEl.textContent = "Ошибка ввода (неверный формат)";
    return;
  }

  const ops = [
    document.getElementById("op1").value,
    document.getElementById("op2").value,
    document.getElementById("op3").value
  ];

  try {
    
    let middleRes = calculateStep(nums[1], nums[2], ops[1]);
    
   
    let finalRes;
    
    const isOp1High = (ops[0] === 'mul' || ops[0] === 'div');
    const isOp3High = (ops[2] === 'mul' || ops[2] === 'div');

    
    
    if (isOp1High && !isOp3High) {
      let leftRes = calculateStep(nums[0], middleRes, ops[0]);
      finalRes = calculateStep(leftRes, nums[3], ops[2]);
    } 
    else if (!isOp1High && isOp3High) {
      let rightRes = calculateStep(middleRes, nums[3], ops[2]);
      finalRes = calculateStep(nums[0], rightRes, ops[0]);
    } 
    else {
      let temp = calculateStep(nums[0], middleRes, ops[0]);
      finalRes = calculateStep(temp, nums[3], ops[2]);
    }

    currentRawResult = finalRes;
    
    mainResultEl.textContent = "Результат: " + formatDisplayResult(finalRes);

    updateRoundedResult();

  } catch (e) {
    mainResultEl.classList.add("error");
    mainResultEl.textContent = e.message;
  }
}


function updateRoundedResult() {
  if (!currentRawResult) return;
  
  const intResultEl = document.getElementById("intResult");
  const type = document.querySelector('input[name="roundingType"]:checked').value;
  let val = currentRawResult;
  let rounded;

  if (type === 'math') {
    rounded = val.toDecimalPlaces(0, Decimal.ROUND_HALF_UP);
  } else if (type === 'bank') {
    rounded = val.toDecimalPlaces(0, Decimal.ROUND_HALF_EVEN);
  } else if (type === 'trunc') {
    rounded = val.toDecimalPlaces(0, Decimal.ROUND_DOWN);
  }

  intResultEl.textContent = formatWithSpaces(rounded.toFixed(0));
}


document.getElementById("calcBtn").addEventListener("click", calculate);


document.querySelectorAll('input[name="roundingType"]').forEach(radio => {
  radio.addEventListener("change", updateRoundedResult);
});

document.querySelectorAll('input[type="text"]').forEach(input => {
  input.addEventListener('paste', (e) => {
    e.preventDefault();
    const paste = (e.clipboardData || window.clipboardData).getData('text');
    const cleaned = paste.replace(/[^0-9,.\- ]/g, '');
    const start = input.selectionStart;
    const end = input.selectionEnd;
    const current = input.value;
    input.value = current.slice(0, start) + cleaned + current.slice(end);
    const newPos = start + cleaned.length;
    input.setSelectionRange(newPos, newPos);
  });
});
</script>
</body>
</html>
